<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Geometry Voyage</title>
    <style>
        html, body {
            margin: 0;
            overflow: hidden;
            background: black;
            cursor: none;
        }

        canvas {
            display: block;
        }

        #title {
            position: absolute;
            top: 20px;
            width: 100%;
            text-align: center;
            font-family: 'Courier New', Courier, monospace;
            font-size: 2rem;
            color: white;
            z-index: 10;
            text-shadow: 0 0 10px #0ff;
        }

        #speedDisplay {
            position: absolute;
            top: 60px;
            width: 100%;
            text-align: center;
            font-family: monospace;
            font-size: 1rem;
            color: #0ff;
        }

        audio {
            display: none;
        }
    </style>
</head>
<body>
<div id="title">ðŸš€ Traveling Through Geometry...</div>
<div id="speedDisplay">Speed: 3.0</div>
<canvas id="canvas"></canvas>
<audio id="bgMusic" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_46b8db8e59.mp3?filename=calm-synth-wave-110858.mp3" autoplay loop></audio>

<script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    let w, h;

    function resize() {
        w = canvas.width = window.innerWidth;
        h = canvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resize);
    resize();

    const shapes = [];
    const shapeTypes = ['triangle', 'square', 'pentagon', 'hexagon', 'octagon'];
    let speed = 3.0;
    const maxSpeed = 15;
    const minSpeed = 0.5;

    let mouseX = w / 2;
    let mouseY = h / 2;
    let pulse = 0;

    window.addEventListener('mousemove', e => {
        mouseX = e.clientX;
        mouseY = e.clientY;
    });

    window.addEventListener('keydown', e => {
        if (e.key === 'w' || e.key === 'W') {
            speed = Math.min(maxSpeed, speed + 0.5);
        }
        if (e.key === 's' || e.key === 'S') {
            speed = Math.max(minSpeed, speed - 0.5);
        }
        document.getElementById('speedDisplay').innerText = `Speed: ${speed.toFixed(1)}`;
    });

    function randomShape() {
        return {
            type: shapeTypes[Math.floor(Math.random() * shapeTypes.length)],
            size: Math.random() * 50 + 20,
            rotation: Math.random() * Math.PI * 2,
            color: `hsl(${Math.random() * 360}, 100%, 70%)`
        };
    }

    for (let i = 0; i < 120; i++) {
        const shape = randomShape();
        shape.size = Math.random() * Math.max(w, h);
        shapes.push(shape);
    }

    function drawPolygon(x, y, sides, radius, rotation, color) {
        ctx.beginPath();
        for (let i = 0; i < sides; i++) {
            const angle = rotation + (i * 2 * Math.PI) / sides;
            const px = x + radius * Math.cos(angle);
            const py = y + radius * Math.sin(angle);
            if (i === 0) ctx.moveTo(px, py);
            else ctx.lineTo(px, py);
        }
        ctx.closePath();
        ctx.strokeStyle = color;
        ctx.lineWidth = 2 + pulse * 4;
        ctx.stroke();
    }

    function getSides(type) {
        switch (type) {
            case 'triangle': return 3;
            case 'square': return 4;
            case 'pentagon': return 5;
            case 'hexagon': return 6;
            case 'octagon': return 8;
            default: return 6;
        }
    }

    // ðŸŽµ Audio Analyser Setup
    const audio = document.getElementById('bgMusic');
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    const source = audioCtx.createMediaElementSource(audio);
    const analyser = audioCtx.createAnalyser();
    analyser.fftSize = 128;

    const bufferLength = analyser.frequencyBinCount;
    const dataArray = new Uint8Array(bufferLength);

    source.connect(analyser);
    analyser.connect(audioCtx.destination);

    function animate() {
        ctx.fillStyle = 'rgba(0, 0, 0, 0.2)';
        ctx.fillRect(0, 0, w, h);

        analyser.getByteFrequencyData(dataArray);
        const avg = dataArray.reduce((a, b) => a + b, 0) / bufferLength;
        pulse = avg / 255; // pulse from 0 to 1

        for (let shape of shapes) {
            shape.size += speed * (1 + pulse * 0.5);
            shape.rotation += 0.01 + pulse * 0.02;
            drawPolygon(mouseX, mouseY, getSides(shape.type), shape.size, shape.rotation, shape.color);

            if (shape.size > Math.max(w, h) * 1.5) {
                Object.assign(shape, randomShape());
                shape.size = 0;
            }
        }

        requestAnimationFrame(animate);
    }

    // Resume audio context on user interaction
    window.addEventListener('click', () => audioCtx.resume());
    animate();
</script>
</body>
</html>
